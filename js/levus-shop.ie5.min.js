// 25-06-2020
"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var BASKET="basket",Basket=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getQuantity",value:function(){return document.querySelector("#basket-quantity")}},{key:"getSum",value:function(){return document.querySelector("#basket-sum")}},{key:"getGoods",value:function(){return document.querySelector("#basket-goods")}},{key:"getClear",value:function(){return document.querySelector("#basket-clear")}},{key:"viewQuantity",value:function(){return Storage.get().reduce(function(e,t){return e+ +t.number},0)}},{key:"viewSum",value:function(){return Storage.get().reduce(function(e,t){return e+t.price*t.number},0)}},{key:"viewGoods",value:function(){return Storage.get().reduce(function(e,t,r){return e+'<p data-id="'.concat(r,'"><i></i><b>').concat(t.name,"</b>, ").concat(t.size,": ").concat(t.price,", ").concat(t.number,"</p>")},"")}},{key:"removeGoods",value:function(t){if("I"===t.target.tagName){var r=t.target.parentNode.dataset.id;Storage.remove(r),e.reload(),Checkout.reload(),Form.reload()}}},{key:"clearBasket",value:function(){Storage.clear(),Checkout.reload(),Form.reload(),e.getQuantity().innerHTML=0,e.getSum().innerHTML=0,e.getGoods().innerHTML=""}},{key:"reload",value:function(){e.getQuantity()&&(Storage.has()?(e.getQuantity().innerHTML=e.viewQuantity(),e.getSum().innerHTML=e.viewSum(),e.getGoods().innerHTML=e.viewGoods()):(e.getQuantity().innerHTML=0,e.getSum().innerHTML=0,e.getGoods().innerHTML=""))}}]),e}(),Items=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getItems",value:function(){return document.querySelectorAll(".button")}},{key:"toBasket",value:function(){var e={name:this.dataset.name,size:this.dataset.size,price:this.dataset.price,number:"1",img:this.dataset.img};Storage.has()?Storage.add(e):Storage.set(e),Basket.reload()}}]),e}(),Storage=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"has",value:function(){return null!==localStorage.getItem(BASKET)}},{key:"get",value:function(){return JSON.parse(localStorage.getItem(BASKET))}},{key:"set",value:function(e){if(Array.isArray(e))localStorage.setItem(BASKET,JSON.stringify(e));else{var t=[];t.push(e),localStorage.setItem(BASKET,JSON.stringify(t))}}},{key:"add",value:function(e){var t=JSON.parse(localStorage.getItem(BASKET));t.find(function(t){return t.name===e.name})?t.find(function(t){return t.name===e.name}).number++:t.push(e),localStorage.setItem(BASKET,JSON.stringify(t))}},{key:"clear",value:function(){localStorage.clear(BASKET)}},{key:"remove",value:function(e){var t=JSON.parse(localStorage.getItem(BASKET));t.splice(e,1),0===t.length?localStorage.removeItem(BASKET):localStorage.setItem(BASKET,JSON.stringify(t))}}]),e}(),Checkout=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getOrderGoods",value:function(){return document.querySelector("#order-goods")}},{key:"getOrderSum",value:function(){return document.querySelector("#order-sum")}},{key:"viewGoods",value:function(){if(Storage.has())return Storage.get().reduce(function(e,t,r){return e+'<div data-id="'.concat(r,'" class="product"><div class="product-img"><img src="').concat(t.img,'" alt=""></div><div class="product-name">').concat(t.name,'</div><div class="product-size">').concat(t.size,'</div><div class="product-price"><small>').concat(t.price,"грн</small><p>").concat(t.price*t.number,'грн</p></div><div class="product-quantity"><span class="minus"></span><span class="number">').concat(t.number,'</span><span class="plus"></span></div><div class="product-delete"><i></i></div></div>')},"")}},{key:"viewSum",value:function(){if(Storage.has())return Storage.get().map(function(e){return e.price*e.number}).reduce(function(e,t){return e+ +t},0)}},{key:"changeGoods",value:function(t){var r=t.target.parentNode.parentNode.dataset.id,n=Storage.get();"I"===t.target.tagName?(n.splice(r,1),0===n.length?Storage.clear():Storage.set(n)):"minus"===t.target.className?n[r].number>1?n[r].number--:n.splice(r,1):"plus"===t.target.className&&n[r].number++,Storage.set(n),e.reload(),Basket.reload(),Form.reload()}},{key:"reload",value:function(){null!==e.getOrderGoods()&&(Storage.has()?(e.getOrderGoods().innerHTML=e.viewGoods(),e.getOrderSum().innerHTML=e.viewSum(),Form.reload()):(e.getOrderGoods().innerHTML="",e.getOrderSum().innerHTML=""))}}]),e}(),Form=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"reload",value:function(){null!==document.querySelector("#order-form")&&(Storage.has()?document.querySelector("#order-form").innerHTML='<form><p><input type="text" placeholder="Ім\'я"></p><p><textarea placeholder="Примітка"></textarea></p><input type="submit" value="Замовити!"></form>':document.querySelector("#order-form").innerHTML="")}}]),e}();Items.getItems().forEach(function(e){return e.addEventListener("click",Items.toBasket)}),Basket.getClear()&&Basket.getClear().addEventListener("click",Basket.clearBasket),Basket.reload(),Basket.getGoods()&&Basket.getGoods().addEventListener("click",Basket.removeGoods),Checkout.reload(),Checkout.getOrderGoods()&&Checkout.getOrderGoods().addEventListener("click",function(e){return Checkout.changeGoods(e)});