// 25-06-2020
const BASKET="basket";class Basket{static getQuantity(){return document.querySelector("#basket-quantity")}static getSum(){return document.querySelector("#basket-sum")}static getGoods(){return document.querySelector("#basket-goods")}static getClear(){return document.querySelector("#basket-clear")}static viewQuantity(){return Storage.get().reduce((e,t)=>e+=+t.number,0)}static viewSum(){return Storage.get().reduce((e,t)=>e+=t.price*t.number,0)}static viewGoods(){return Storage.get().reduce((e,t,a)=>e+=`<p data-id="${a}"><i></i><b>${t.name}</b>, ${t.size}: ${t.price}, ${t.number}</p>`,"")}static removeGoods(e){if("I"===e.target.tagName){const t=e.target.parentNode.dataset.id;Storage.remove(t),Basket.reload(),Checkout.reload(),Form.reload()}}static clearBasket(){Storage.clear(),Checkout.reload(),Form.reload(),Basket.getQuantity().innerHTML=0,Basket.getSum().innerHTML=0,Basket.getGoods().innerHTML=""}static reload(){Basket.getQuantity()&&(Storage.has()?(Basket.getQuantity().innerHTML=Basket.viewQuantity(),Basket.getSum().innerHTML=Basket.viewSum(),Basket.getGoods().innerHTML=Basket.viewGoods()):(Basket.getQuantity().innerHTML=0,Basket.getSum().innerHTML=0,Basket.getGoods().innerHTML=""))}}class Items{static getItems(){return document.querySelectorAll(".button")}static toBasket(){const e={name:this.dataset.name,size:this.dataset.size,price:this.dataset.price,number:"1",img:this.dataset.img};Storage.has()?Storage.add(e):Storage.set(e),Basket.reload()}}class Storage{static has(){return null!==localStorage.getItem(BASKET)}static get(){return JSON.parse(localStorage.getItem(BASKET))}static set(e){if(Array.isArray(e))localStorage.setItem(BASKET,JSON.stringify(e));else{const t=[];t.push(e),localStorage.setItem(BASKET,JSON.stringify(t))}}static add(e){const t=JSON.parse(localStorage.getItem(BASKET));if(t.find(t=>t.name===e.name)){t.find(t=>t.name===e.name).number++}else t.push(e);localStorage.setItem(BASKET,JSON.stringify(t))}static clear(){localStorage.clear(BASKET)}static remove(e){const t=JSON.parse(localStorage.getItem(BASKET));t.splice(e,1),0===t.length?localStorage.removeItem(BASKET):localStorage.setItem(BASKET,JSON.stringify(t))}}class Checkout{static getOrderGoods(){return document.querySelector("#order-goods")}static getOrderSum(){return document.querySelector("#order-sum")}static viewGoods(){if(Storage.has()){return Storage.get().reduce((e,t,a)=>e+`<div data-id="${a}" class="product"><div class="product-img"><img src="${t.img}" alt=""></div><div class="product-name">${t.name}</div><div class="product-size">${t.size}</div><div class="product-price"><small>${t.price}грн</small><p>${t.price*t.number}грн</p></div><div class="product-quantity"><span class="minus"></span><span class="number">${t.number}</span><span class="plus"></span></div><div class="product-delete"><i></i></div></div>`,"")}}static viewSum(){if(Storage.has())return Storage.get().map(e=>e.price*e.number).reduce((e,t)=>e+ +t,0)}static changeGoods(e){const t=e.target.parentNode.parentNode.dataset.id,a=Storage.get();"I"===e.target.tagName?(a.splice(t,1),0===a.length?Storage.clear():Storage.set(a)):"minus"===e.target.className?a[t].number>1?a[t].number--:a.splice(t,1):"plus"===e.target.className&&a[t].number++,Storage.set(a),Checkout.reload(),Basket.reload(),Form.reload()}static reload(){null!==Checkout.getOrderGoods()&&(Storage.has()?(Checkout.getOrderGoods().innerHTML=Checkout.viewGoods(),Checkout.getOrderSum().innerHTML=Checkout.viewSum(),Form.reload()):(Checkout.getOrderGoods().innerHTML="",Checkout.getOrderSum().innerHTML=""))}}class Form{static reload(){null!==document.querySelector("#order-form")&&(Storage.has()?document.querySelector("#order-form").innerHTML='<form><p><input type="text" placeholder="Ім\'я"></p><p><textarea placeholder="Примітка"></textarea></p><input type="submit" value="Замовити!"></form>':document.querySelector("#order-form").innerHTML="")}}Items.getItems().forEach(e=>e.addEventListener("click",Items.toBasket)),Basket.getClear()&&Basket.getClear().addEventListener("click",Basket.clearBasket),Basket.reload(),Basket.getGoods()&&Basket.getGoods().addEventListener("click",Basket.removeGoods),Checkout.reload(),Checkout.getOrderGoods()&&Checkout.getOrderGoods().addEventListener("click",e=>Checkout.changeGoods(e));